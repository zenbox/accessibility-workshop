<!DOCTYPE html>

<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=0.5, maximum-scale=3.0, user-scalable=yes">
    <title>Visus-Simulator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

```
    body {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        overflow-x: hidden;
        transition: background-color 0.3s, color 0.3s;
    }

    body.high-contrast {
        background-color: #000000;
        color: #FFFFFF;
    }

    body.high-contrast #example-content h1,
    body.high-contrast #example-content h2,
    body.high-contrast #example-content p {
        color: #FFFFFF;
    }

    body.high-contrast .color-samples {
        border: 2px solid #FFFFFF;
        padding: 10px;
    }

    body.high-contrast .image-sample {
        border: 3px solid #FFFF00;
    }

    #example-content {
        padding: 40px 20px;
        max-width: 1200px;
        margin: 0 auto;
        transition: filter 0.3s ease;
    }

    #example-content h1 {
        color: #2c3e50;
        margin-bottom: 20px;
        font-size: clamp(24px, 5vw, 32px);
    }

    #example-content h2 {
        color: #34495e;
        margin-top: 30px;
        margin-bottom: 15px;
        font-size: clamp(18px, 4vw, 24px);
    }

    #example-content p {
        line-height: 1.8;
        margin-bottom: 15px;
        color: #34495e;
    }

    .color-samples {
        display: flex;
        gap: 15px;
        margin: 30px 0;
        flex-wrap: wrap;
    }

    .color-box {
        width: 80px;
        height: 80px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: bold;
        text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        font-size: 14px;
    }

    .image-sample {
        width: 100%;
        max-width: 600px;
        height: 250px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 12px;
        margin: 20px 0;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 20px;
    }

    #control-panel {
        position: fixed;
        top: 20px;
        right: 20px;
        background: rgba(255, 255, 255, 0.98);
        border-radius: 12px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        max-width: 340px;
        z-index: 1000;
        backdrop-filter: blur(10px);
        transition: all 0.3s ease;
    }

    #control-panel.collapsed {
        max-height: 60px;
        overflow: hidden;
    }

    body.high-contrast #control-panel {
        background: rgba(0, 0, 0, 0.98);
        border: 3px solid #FFFF00;
    }

    body.high-contrast #control-panel label,
    body.high-contrast #control-panel .panel-header,
    body.high-contrast #control-panel .value-display {
        color: #FFFFFF;
    }

    body.high-contrast .control-group {
        background: #1a1a1a;
        border: 1px solid #FFFF00;
    }

    .panel-header {
        font-weight: bold;
        padding: 15px;
        color: #2c3e50;
        cursor: move;
        touch-action: none;
        display: flex;
        justify-content: space-between;
        align-items: center;
        user-select: none;
        border-bottom: 2px solid #3498db;
    }

    .panel-header-text {
        pointer-events: none;
    }

    .toggle-btn {
        background: #3498db;
        color: white;
        border: none;
        width: 30px;
        height: 30px;
        border-radius: 50%;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 18px;
        transition: transform 0.3s ease, background 0.2s;
        flex-shrink: 0;
        touch-action: manipulation;
    }

    .toggle-btn:hover {
        background: #2980b9;
    }

    .toggle-btn:active {
        transform: scale(0.95);
    }

    #control-panel.collapsed .toggle-btn {
        transform: rotate(180deg);
    }

    .panel-content {
        padding: 15px;
        max-height: calc(90vh - 80px);
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
    }

    .control-group {
        margin-bottom: 15px;
        padding: 10px;
        background: #f8f9fa;
        border-radius: 6px;
    }

    .control-group label {
        display: block;
        margin-bottom: 5px;
        font-size: 13px;
        font-weight: 600;
        color: #495057;
        cursor: pointer;
    }

    .info-text {
        font-size: 11px;
        color: #6c757d;
        font-style: italic;
        margin-top: 5px;
        line-height: 1.3;
    }

    body.high-contrast .info-text {
        color: #CCCCCC;
    }

    input[type="range"] {
        width: 100%;
        margin: 5px 0;
        -webkit-appearance: none;
        appearance: none;
        height: 8px;
        border-radius: 5px;
        background: #d3d3d3;
        outline: none;
    }

    input[type="range"]::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background: #3498db;
        cursor: pointer;
    }

    input[type="range"]::-moz-range-thumb {
        width: 20px;
        height: 20px;
        border-radius: 50%;
        background: #3498db;
        cursor: pointer;
        border: none;
    }

    input[type="checkbox"] {
        margin-right: 8px;
        width: 18px;
        height: 18px;
        cursor: pointer;
    }

    .value-display {
        font-size: 12px;
        color: #6c757d;
        margin-top: 3px;
    }

    .reset-btn, .contrast-btn {
        width: 100%;
        padding: 10px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-weight: 600;
        margin-top: 10px;
        font-size: 14px;
        touch-action: manipulation;
        transition: all 0.2s;
    }

    .reset-btn {
        background: #e74c3c;
        color: white;
    }

    .reset-btn:hover {
        background: #c0392b;
    }

    .reset-btn:active {
        transform: scale(0.98);
    }

    .contrast-btn {
        background: #000000;
        color: #FFFF00;
        border: 2px solid #FFFF00;
    }

    .contrast-btn:hover {
        background: #FFFF00;
        color: #000000;
    }

    .contrast-btn:active {
        transform: scale(0.98);
    }

    #effect-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 999;
    }

    @media (max-width: 768px) {
        #control-panel {
            right: 10px;
            top: 10px;
            max-width: calc(100vw - 20px);
        }

        .color-box {
            width: 70px;
            height: 70px;
            font-size: 12px;
        }

        #example-content {
            padding: 20px 15px;
        }
    }
</style>
```

</head>
<body>
    <div id="effect-overlay"></div>

```
<div id="example-content">
    <h1>Beispiel-Webseite f√ºr Visus-Simulation</h1>
    
    <p>Dies ist eine Beispielseite, um verschiedene Seheinschr√§nkungen zu simulieren. 
    Der Text sollte in verschiedenen Gr√∂√üen und Kontrasten lesbar sein.</p>
    
    <h2>Farbproben zur √úberpr√ºfung von Farbenfehlsichtigkeit</h2>
    <div class="color-samples">
        <div class="color-box" style="background: #e74c3c;">Rot</div>
        <div class="color-box" style="background: #2ecc71;">Gr√ºn</div>
        <div class="color-box" style="background: #3498db;">Blau</div>
        <div class="color-box" style="background: #f39c12;">Orange</div>
        <div class="color-box" style="background: #9b59b6;">Lila</div>
        <div class="color-box" style="background: #1abc9c;">T√ºrkis</div>
    </div>

    <div class="image-sample">
        Beispiel-Bildbereich
    </div>

    <h2>Textbeispiel in verschiedenen Gr√∂√üen</h2>
    <p style="font-size: 20px;">Gro√üe Schrift ‚Äì sollte auch bei Kurzsichtigkeit erkennbar sein</p>
    <p style="font-size: 16px;">Mittlere Schrift ‚Äì Standardgr√∂√üe f√ºr Flie√ütext</p>
    <p style="font-size: 12px;">Kleine Schrift ‚Äì kann bei Seheinschr√§nkungen schwer lesbar sein</p>
    <p style="font-size: 10px;">Sehr kleine Schrift ‚Äì Test f√ºr Detailerkennung</p>

    <h2>Kontrastbeispiele</h2>
    <p style="background: #f0f0f0; padding: 10px; border-radius: 4px;">
        Grauer Hintergrund mit schwarzem Text ‚Äì mittlerer Kontrast
    </p>
    <p style="background: #333; color: white; padding: 10px; border-radius: 4px;">
        Dunkler Hintergrund mit wei√üem Text ‚Äì hoher Kontrast
    </p>

    <h2>Orientierungstest</h2>
    <p>Bei Makuladegeneration k√∂nnen Sie diesen Text in der Peripherie noch wahrnehmen, 
    aber nicht direkt lesen. Bei Tunnelblick ist es genau umgekehrt - Sie sehen nur 
    den Bereich, auf den Sie direkt schauen.</p>
</div>

<div id="control-panel">
    <div class="panel-header" id="panel-header">
        <span class="panel-header-text">üëÅÔ∏è Visus-Simulator</span>
        <button class="toggle-btn" id="toggle-btn" onclick="togglePanel()">‚ñº</button>
    </div>

    <div class="panel-content" id="panel-content">
        <button class="contrast-btn" onclick="toggleHighContrast()">
            üî≤ Hochkontrast-Modus
        </button>

        <div class="control-group">
            <label>Betrachtungsabstand zum Bildschirm</label>
            <input type="range" id="viewing-distance" min="20" max="80" step="5" value="50">
            <div class="value-display">Abstand: <span id="distance-value">50</span> cm</div>
            <div class="info-text">Beeinflusst die Unsch√§rfe bei Fehlsichtigkeit (20cm=Handy, 50-80cm=Desktop)</div>
        </div>

        <div class="control-group">
            <label>Seiten-Zoom</label>
            <input type="range" id="page-zoom" min="100" max="800" step="50" value="100">
            <div class="value-display">Zoom: <span id="zoom-value">100</span>%</div>
            <div class="info-text">Vergr√∂√üert die gesamte Seite - Demonstriert Hilfsmittel f√ºr Sehschwache</div>
        </div>

        <div class="control-group">
            <label>
                <input type="checkbox" id="protanopia"> Protanopie (Rotschw√§che)
            </label>
            <label>
                <input type="checkbox" id="deuteranopia"> Deuteranopie (Gr√ºnschw√§che)
            </label>
            <label>
                <input type="checkbox" id="tritanopia"> Tritanopie (Blauschw√§che)
            </label>
            <label>
                <input type="checkbox" id="achromatopsia"> Achromatopsie (Farbenblind)
            </label>
        </div>

        <div class="control-group">
            <label>Kurzsichtigkeit (Myopie)</label>
            <input type="checkbox" id="myopia-enable">
            <input type="range" id="myopia" min="0" max="10" step="0.5" value="0">
            <div class="value-display">Dioptrien: <span id="myopia-value">0.0</span> | Visus: <span id="myopia-visus">1.0</span></div>
            <div class="info-text">Fernsicht verschwommen</div>
        </div>

        <div class="control-group">
            <label>Weitsichtigkeit (Hyperopie)</label>
            <input type="checkbox" id="hyperopia-enable">
            <input type="range" id="hyperopia" min="0" max="8" step="0.5" value="0">
            <div class="value-display">Dioptrien: <span id="hyperopia-value">0.0</span> | Visus: <span id="hyperopia-visus">1.0</span></div>
            <div class="info-text">Nahsicht verschwommen</div>
        </div>

        <div class="control-group">
            <label>Tunnelblick (Gesichtsfeldausfall peripher)</label>
            <input type="checkbox" id="tunnel-enable">
            <input type="range" id="tunnel" min="5" max="50" step="5" value="50">
            <div class="value-display">Sichtfeld-Radius: <span id="tunnel-value">50</span>%</div>
            <div class="info-text">Nur zentrales Sehen erhalten, Peripherie schwarz (z.B. Glaukom)</div>
        </div>

        <div class="control-group">
            <label>Makuladegeneration (zentraler Ausfall)</label>
            <input type="checkbox" id="macular-enable">
            <input type="range" id="macular" min="0" max="100" step="10" value="0">
            <div class="value-display">Intensit√§t: <span id="macular-value">0</span>%</div>
            <div class="info-text">Zentrales Sehen ausgefallen, nur Peripherie funktioniert</div>
        </div>

        <button class="reset-btn" onclick="resetAll()">Alle zur√ºcksetzen</button>
    </div>
</div>

<script>
    const content = document.getElementById('example-content');
    const overlay = document.getElementById('effect-overlay');
    const panel = document.getElementById('control-panel');
    const panelHeader = document.getElementById('panel-header');
    
    // Globale Variable f√ºr Zoom-Faktor
    let currentZoom = 1;
    let viewingDistance = 50; // in cm
    
    // Auf/Zuklappen
    function togglePanel() {
        panel.classList.toggle('collapsed');
    }

    // Hochkontrast-Modus
    function toggleHighContrast() {
        document.body.classList.toggle('high-contrast');
    }

    // Visus-Berechnung basierend auf Dioptrien und Entfernung (physikalisch korrekter)
    function calculateVisus(diopters, distanceCm) {
        if (diopters === 0) return 1.0;
        
        // Fernpunkt in Metern: 1/Dioptrien
        const farPoint = 1 / Math.abs(diopters); // in Metern
        const distanceM = distanceCm / 100;
        
        // F√ºr Myopie (Kurzsichtigkeit): gut in der N√§he, schlecht in der Ferne
        // F√ºr Hyperopie (Weitsichtigkeit): schlecht in der N√§he, besser in der Ferne
        
        let visus;
        if (diopters > 0) {
            // Hyperopie: Je n√§her desto schlechter
            const defocus = Math.abs(diopters * distanceM);
            visus = Math.max(0.05, 1.0 / (1 + defocus * 2));
        } else {
            // Myopie: Scharf bis zum Fernpunkt, dann unscharf
            if (distanceM <= farPoint) {
                // Innerhalb des Fernpunkts: gutes Sehen
                visus = 1.0;
            } else {
                // Au√üerhalb des Fernpunkts: unscharf
                const defocus = Math.abs((1/distanceM) - diopters);
                visus = Math.max(0.05, 1.0 / (1 + defocus * 3));
            }
        }
        
        return visus.toFixed(2);
    }
    
    // Blur-Berechnung basierend auf Zerstreuungskreis (Circle of Confusion)
    function calculateBlur(diopters, distanceCm, isMyopia) {
        if (diopters === 0) return 0;
        
        const distanceM = distanceCm / 100;
        const pupilDiameter = 0.004; // 4mm Pupille bei normaler Beleuchtung
        
        if (isMyopia) {
            // Myopie: Fernpunkt in Metern
            const farPoint = 1 / Math.abs(diopters);
            
            if (distanceM <= farPoint) {
                // Innerhalb des Fernpunkts: scharf
                return 0;
            } else {
                // Au√üerhalb: Zerstreuungskreis w√§chst
                const defocus = Math.abs((1/distanceM) - diopters);
                // CoC in Metern auf der Netzhaut, umgerechnet in Pixel (approximiert)
                const coc = pupilDiameter * defocus * distanceM * distanceM;
                // Umrechnung in wahrgenommene Pixel-Unsch√§rfe (Faktor 3000 empirisch)
                return coc * 3000;
            }
        } else {
            // Hyperopie: immer Akkommodationsbedarf in der N√§he
            const defocus = diopters * distanceM;
            const coc = pupilDiameter * defocus * distanceM;
            return coc * 3000;
        }
    }

    // Farbenfehlsichtigkeit Filter
    const colorFilters = {
        protanopia: 'url(#protanopia-filter)',
        deuteranopia: 'url(#deuteranopia-filter)',
        tritanopia: 'url(#tritanopia-filter)',
        achromatopsia: 'grayscale(100%)'
    };

    // SVG Filter f√ºr Farbenfehlsichtigkeit
    const svgFilters = `
        <svg style="position: absolute; width: 0; height: 0;">
            <defs>
                <filter id="protanopia-filter">
                    <feColorMatrix type="matrix" values="
                        0.567, 0.433, 0.0, 0.0, 0.0
                        0.558, 0.442, 0.0, 0.0, 0.0
                        0.0, 0.242, 0.758, 0.0, 0.0
                        0.0, 0.0, 0.0, 1.0, 0.0"/>
                </filter>
                <filter id="deuteranopia-filter">
                    <feColorMatrix type="matrix" values="
                        0.625, 0.375, 0.0, 0.0, 0.0
                        0.7, 0.3, 0.0, 0.0, 0.0
                        0.0, 0.3, 0.7, 0.0, 0.0
                        0.0, 0.0, 0.0, 1.0, 0.0"/>
                </filter>
                <filter id="tritanopia-filter">
                    <feColorMatrix type="matrix" values="
                        0.95, 0.05, 0.0, 0.0, 0.0
                        0.0, 0.433, 0.567, 0.0, 0.0
                        0.0, 0.475, 0.525, 0.0, 0.0
                        0.0, 0.0, 0.0, 1.0, 0.0"/>
                </filter>
            </defs>
        </svg>
    `;
    document.body.insertAdjacentHTML('afterbegin', svgFilters);

    function applyEffects() {
        let filters = [];
        let overlayHTML = '';

        // Farbenfehlsichtigkeit
        ['protanopia', 'deuteranopia', 'tritanopia', 'achromatopsia'].forEach(type => {
            if (document.getElementById(type).checked) {
                filters.push(colorFilters[type]);
            }
        });

        // Kurzsichtigkeit - Physikalisch korrekt mit Abstand
        if (document.getElementById('myopia-enable').checked) {
            const diopters = parseFloat(document.getElementById('myopia').value);
            const baseBlur = calculateBlur(diopters, viewingDistance, true);
            const adjustedBlur = baseBlur / currentZoom;
            if (adjustedBlur > 0.1) {
                filters.push(`blur(${adjustedBlur}px)`);
            }
        }

        // Weitsichtigkeit - Physikalisch korrekt mit Abstand
        if (document.getElementById('hyperopia-enable').checked) {
            const diopters = parseFloat(document.getElementById('hyperopia').value);
            const baseBlur = calculateBlur(diopters, viewingDistance, false);
            const adjustedBlur = baseBlur / currentZoom;
            if (adjustedBlur > 0.1) {
                filters.push(`blur(${adjustedBlur}px)`);
            }
        }

        content.style.filter = filters.join(' ');

        // Tunnelblick
        if (document.getElementById('tunnel-enable').checked) {
            const value = document.getElementById('tunnel').value;
            overlayHTML += `
                <div style="
                    position: fixed;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    background: radial-gradient(circle at center, 
                        transparent 0%, 
                        transparent ${value}%, 
                        rgba(0,0,0,1) ${parseFloat(value) + 5}%);
                    pointer-events: none;
                "></div>
            `;
        }

        // Makuladegeneration
        if (document.getElementById('macular-enable').checked) {
            const value = document.getElementById('macular').value;
            const opacity = value / 100;
            const blurAmount = 15 + (value / 10);
            
            overlayHTML += `
                <div style="
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    width: 35vw;
                    height: 35vh;
                    background: radial-gradient(circle at center, 
                        rgba(150,150,150,${opacity * 0.9}) 0%, 
                        rgba(100,100,100,${opacity * 0.7}) 30%,
                        rgba(80,80,80,${opacity * 0.4}) 60%,
                        transparent 100%);
                    filter: blur(${blurAmount}px);
                    pointer-events: none;
                "></div>
                <div style="
                    position: fixed;
                    top: 50%;
                    left: 50%;
                    transform: translate(-50%, -50%);
                    width: 25vw;
                    height: 25vh;
                    background: rgba(120,120,100,${opacity * 0.5});
                    border-radius: 50%;
                    filter: blur(${blurAmount * 1.5}px);
                    pointer-events: none;
                "></div>
            `;
        }

        overlay.innerHTML = overlayHTML;
    }

    // Event Listeners
    document.querySelectorAll('input[type="checkbox"], input[type="range"]').forEach(input => {
        input.addEventListener('change', applyEffects);
        input.addEventListener('input', applyEffects);
    });

    // Werte-Anzeigen aktualisieren
    document.getElementById('myopia').addEventListener('input', function() {
        const value = parseFloat(this.value);
        document.getElementById('myopia-value').textContent = value.toFixed(1);
        document.getElementById('myopia-visus').textContent = calculateVisus(-value, viewingDistance);
    });

    document.getElementById('hyperopia').addEventListener('input', function() {
        const value = parseFloat(this.value);
        document.getElementById('hyperopia-value').textContent = value.toFixed(1);
        document.getElementById('hyperopia-visus').textContent = calculateVisus(value, viewingDistance);
    });

    document.getElementById('tunnel').addEventListener('input', function() {
        document.getElementById('tunnel-value').textContent = this.value;
    });

    document.getElementById('macular').addEventListener('input', function() {
        document.getElementById('macular-value').textContent = this.value;
    });

    // Betrachtungsabstand
    document.getElementById('viewing-distance').addEventListener('input', function() {
        viewingDistance = parseFloat(this.value);
        document.getElementById('distance-value').textContent = this.value;
        
        // Visus-Werte neu berechnen
        const myopiaValue = parseFloat(document.getElementById('myopia').value);
        const hyperopiaValue = parseFloat(document.getElementById('hyperopia').value);
        document.getElementById('myopia-visus').textContent = calculateVisus(-myopiaValue, viewingDistance);
        document.getElementById('hyperopia-visus').textContent = calculateVisus(hyperopiaValue, viewingDistance);
        
        // Effekte neu anwenden mit angepasstem Blur
        applyEffects();
    });

    // Seiten-Zoom
    document.getElementById('page-zoom').addEventListener('input', function() {
        const value = this.value;
        document.getElementById('zoom-value').textContent = value;
        currentZoom = value / 100; // Globale Variable aktualisieren
        content.style.transform = `scale(${currentZoom})`;
        content.style.transformOrigin = 'top center';
        content.style.width = `${100 / currentZoom}%`;
        
        // Effekte neu anwenden mit angepasstem Blur
        applyEffects();
    });

    function resetAll() {
        document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
        document.querySelectorAll('input[type="range"]').forEach(range => {
            if (range.id === 'tunnel') {
                range.value = 50;
            } else if (range.id === 'page-zoom') {
                range.value = 100;
            } else {
                range.value = 0;
            }
        });
        document.getElementById('myopia-value').textContent = '0.0';
        document.getElementById('myopia-visus').textContent = '1.0';
        document.getElementById('hyperopia-value').textContent = '0.0';
        document.getElementById('hyperopia-visus').textContent = '1.0';
        document.getElementById('tunnel-value').textContent = '50';
        document.getElementById('macular-value').textContent = '0';
        document.getElementById('zoom-value').textContent = '100';
        currentZoom = 1; // Globale Variable zur√ºcksetzen
        content.style.transform = 'scale(1)';
        content.style.width = '100%';
        document.body.classList.remove('high-contrast');
        applyEffects();
    }

    // Draggable mit Touch-Support
    let isDragging = false;
    let currentX, currentY, initialX, initialY;

    // Mouse Events
    panelHeader.addEventListener('mousedown', dragStart);
    document.addEventListener('mousemove', drag);
    document.addEventListener('mouseup', dragEnd);

    // Touch Events f√ºr iPhone
    panelHeader.addEventListener('touchstart', touchStart, { passive: false });
    document.addEventListener('touchmove', touchDrag, { passive: false });
    document.addEventListener('touchend', dragEnd);

    function dragStart(e) {
        if (e.target.closest('.toggle-btn')) return;
        
        initialX = e.clientX - panel.offsetLeft;
        initialY = e.clientY - panel.offsetTop;
        isDragging = true;
    }

    function touchStart(e) {
        if (e.target.closest('.toggle-btn')) return;
        
        const touch = e.touches[0];
        initialX = touch.clientX - panel.offsetLeft;
        initialY = touch.clientY - panel.offsetTop;
        isDragging = true;
        e.preventDefault();
    }

    function drag(e) {
        if (!isDragging) return;
        e.preventDefault();
        
        currentX = e.clientX - initialX;
        currentY = e.clientY - initialY;

        updatePosition(currentX, currentY);
    }

    function touchDrag(e) {
        if (!isDragging) return;
        e.preventDefault();
        
        const touch = e.touches[0];
        currentX = touch.clientX - initialX;
        currentY = touch.clientY - initialY;

        updatePosition(currentX, currentY);
    }

    function updatePosition(x, y) {
        const maxX = window.innerWidth - panel.offsetWidth;
        const maxY = window.innerHeight - panel.offsetHeight;

        x = Math.max(0, Math.min(x, maxX));
        y = Math.max(0, Math.min(y, maxY));

        panel.style.left = x + 'px';
        panel.style.top = y + 'px';
        panel.style.right = 'auto';
    }

    function dragEnd() {
        isDragging = false;
    }
</script>
```

</body>
</html>