<!DOCTYPE html>

<html lang="de">
    <head>
        <title>Raumliste mit Tastaturnavigation und VoiceOver Simulation</title>
        <meta charset="utf-8" />
        <meta
            name="viewport"
            content="width=device-width"
        />
        <link
            href="https://fonts.googleapis.com/css2?family=Barlow:wght@400;700&display=swap"
            rel="stylesheet"
        />
        <style>
            html {
                font-family: Barlow;
                background: #f5f5f5;
                padding: 20px;
            }

            /* Focus animation */
            @keyframes focusPulse {
                0% {
                    box-shadow: 0 0 0 2px #007bff;
                }
                50% {
                    box-shadow: 0 0 0 4px #007bff66;
                }
                100% {
                    box-shadow: 0 0 0 2px #007bff;
                }
            }

            .focus-outline {
                outline: none;
                border-radius: 4px;
                animation: focusPulse 1.5s infinite;
            }

            /* Special focus style for room in detail mode */
            .room-detail-focus {
                outline: none;
                border-radius: 8px;
                box-shadow: 0 0 0 3px #28a745;
                border-color: #28a745 !important;
                background: #f8fff9 !important;
            }

            fieldset {
                border: 2px solid #ddd;
                border-radius: 8px;
                padding: 20px;
                background: white;
                max-width: 600px;
            }

            legend {
                font-weight: 700;
                font-size: 1.2em;
                padding: 0 10px;
            }

            ul,
            ol {
                list-style: none;
                padding: 0;
                margin: 0;
            }

            .room-item {
                margin: 10px 0;
                padding: 15px;
                border: 2px solid #e0e0e0;
                border-radius: 8px;
                background: #fafafa;
                cursor: pointer;
                transition: all 0.3s ease;
            }

            .room-item:hover {
                background: #f0f0f0;
                border-color: #007bff;
            }

            .room-item.selected {
                background: #e3f2fd;
                border-color: #007bff;
            }

            .room-header {
                display: flex;
                align-items: center;
                gap: 10px;
            }

            .room-details {
                margin-top: 15px;
                padding-left: 30px;
            }

            .room-details ol {
                display: flex;
                flex-direction: column;
                gap: 10px;
            }

            .detail-item {
                padding: 8px 12px;
                background: white;
                border: 1px solid #ddd;
                border-radius: 4px;
                cursor: pointer;
                transition: all 0.3s ease;
            }

            .detail-item:hover {
                background: #f0f8ff;
                border-color: #007bff;
            }

            .numbers {
                display: flex;
                gap: 15px;
            }

            .number-item {
                padding: 8px 16px;
                background: #007bff;
                color: white;
                border-radius: 20px;
                font-weight: 700;
                cursor: pointer;
                transition: all 0.3s ease;
            }

            .number-item:hover {
                background: #0056b3;
                transform: scale(1.05);
            }

            input[type="radio"] {
                width: 18px;
                height: 18px;
                cursor: pointer;
            }

            label {
                font-weight: 700;
                cursor: pointer;
                user-select: none;
            }

            .hidden {
                display: none;
            }

            /* Screenreader simulation */
            .screenreader-output {
                position: fixed;
                top: 20px;
                right: 20px;
                background: #1a1a1a;
                color: #00ff00;
                padding: 15px;
                border-radius: 8px;
                font-family: monospace;
                font-size: 0.9em;
                max-width: 300px;
                min-height: 100px;
                border: 2px solid #333;
                z-index: 1000;
            }

            .screenreader-title {
                color: #ffff00;
                font-weight: bold;
                margin-bottom: 10px;
                border-bottom: 1px solid #333;
                padding-bottom: 5px;
            }

            .screenreader-text {
                line-height: 1.4;
                word-wrap: break-word;
            }

            /* Keyboard navigation indicators */
            .keyboard-hint {
                position: fixed;
                bottom: 20px;
                right: 20px;
                background: #333;
                color: white;
                padding: 10px 15px;
                border-radius: 8px;
                font-size: 0.9em;
                opacity: 0.8;
            }
        </style>
        <style>
            @media (min-width: 768px) {
                .room-item,
                .room-details ol {
                    display: flex;
                    flex-direction: row;
                    justify-content: space-between;
                    align-items: center;
                }
            }
        </style>
        <style>
            /* HIGH CONTRAST OVERWRITE */
            @media screen and (prefers-contrast: more) {
                /* Basis-Reset für alle Elemente */
                * {
                    background: black !important;
                    color: white !important;
                    border-color: white !important;
                    animation: none !important;
                    transition: none !important;
                }

                /* Spezifische Zustände */
                :hover {
                    background: #333 !important;
                    border-color: #f2ec33 !important;
                    color: white !important;
                }

                :focus {
                    background: black !important;
                    color: white !important;
                    outline: 3px solid #3dd7fd !important;
                    box-shadow: 0 0 0 3px #3dd7fd !important;
                }

                :disabled {
                    background: black !important;
                    color: #666 !important;
                    border-color: #666 !important;
                }

                /* Ausgewählte Elemente */
                .selected,
                :checked {
                    background: black !important;
                    color: white !important;
                    border-color: #3dd7fd !important;
                }

                /* Spezielle Fokus-Klassen */
                .focus-outline {
                    box-shadow: 0 0 0 3px #3dd7fd !important;
                }

                .room-detail-focus {
                    box-shadow: 0 0 0 3px #f2ec33 !important;
                    border-color: #f2ec33 !important;
                }

                /* Number Items - invertiert für bessere Sichtbarkeit */
                .number-item {
                    background: white !important;
                    color: black !important;
                }

                .number-item:hover {
                    background: #f2ec33 !important;
                    color: black !important;
                }

                /* Text-Selektion */
                ::selection {
                    background: #3dd7fd !important;
                    color: black !important;
                }
            }

            /* REDUCE MOTION OVERWRITE */
            @media screen and (prefers-reduced-motion: reduce) {
                body {
                    *,
                    *::before,
                    *::after {
                        scroll-behavior: auto !important;
                        animation-duration: 0.01s !important;
                        transition-duration: 0.01s !important;
                    }
                }
            }
        </style>
    </head>

    <body>
        <form
            method="post"
            action=""
        >
            <fieldset>
                <legend>Räume</legend>
                <!-- Versteckte Beschreibung für alle Radiobuttons -->
                <div
                    id="room-navigation-help"
                    class="sr-only"
                >
                    Zum Erweitern der Details, Pfeil rechts drücken. Escape zum
                    Verlassen der Details.
                </div>

                <ul id="room-list">
                    <li
                        class="room-item"
                        data-room="one"
                    >
                        <header class="room-header">
                            <input
                                type="radio"
                                id="room-1"
                                name="rooms"
                                value="one"
                                aria-describedby="room-navigation-help"
                            />
                            <label for="room-1">Raum Eins</label>
                        </header>
                        <div class="room-details">
                            <ol>
                                <li
                                    class="detail-item numbers"
                                    tabindex="0"
                                >
                                    <span
                                        class="number-item"
                                        tabindex="0"
                                        >12</span
                                    >
                                    <span
                                        class="number-item"
                                        tabindex="0"
                                        >5</span
                                    >
                                    <span
                                        class="number-item"
                                        tabindex="0"
                                        >8</span
                                    >
                                </li>
                                <li
                                    class="detail-item"
                                    tabindex="0"
                                >
                                    <p>
                                        Lorem ipsum dolor sit, amet consectetur
                                        adipisicing elit. Eaque quibusdam sit
                                        tenetur modi, nesciunt excepturi quos id
                                        dolor laudantium voluptatem dolorem.
                                    </p>
                                </li>
                                <li
                                    class="detail-item"
                                    tabindex="0"
                                >
                                    <i>Check-in verfügbar</i>
                                </li>
                            </ol>
                        </div>
                    </li>

                    <li
                        class="room-item"
                        data-room="two"
                    >
                        <header class="room-header">
                            <input
                                type="radio"
                                id="room-2"
                                name="rooms"
                                value="two"
                                aria-describedby="room-navigation-help"
                            />
                            <label for="room-2">Raum Zwei</label>
                        </header>
                        <div class="room-details">
                            <ol>
                                <li
                                    class="detail-item numbers"
                                    tabindex="0"
                                >
                                    <span
                                        class="number-item"
                                        tabindex="0"
                                        >9</span
                                    >
                                    <span
                                        class="number-item"
                                        tabindex="0"
                                        >3</span
                                    >
                                    <span
                                        class="number-item"
                                        tabindex="0"
                                        >6</span
                                    >
                                </li>
                                <li
                                    class="detail-item"
                                    tabindex="0"
                                >
                                    <p>
                                        Lorem ipsum dolor sit amet consectetur
                                        adipisicing elit. Voluptatibus, nulla?
                                        Quos voluptatem repellendus sunt nostrum
                                        dolores eveniet.
                                    </p>
                                </li>
                                <li
                                    class="detail-item"
                                    tabindex="0"
                                >
                                    <i>Früher Check-in möglich</i>
                                </li>
                            </ol>
                        </div>
                    </li>

                    <li
                        class="room-item"
                        data-room="three"
                    >
                        <header class="room-header">
                            <input
                                type="radio"
                                id="room-3"
                                name="rooms"
                                value="three"
                                aria-describedby="room-navigation-help"
                            />
                            <label for="room-3">Raum Drei</label>
                        </header>
                        <div class="room-details">
                            <ol>
                                <li
                                    class="detail-item numbers"
                                    tabindex="0"
                                >
                                    <span
                                        class="number-item"
                                        tabindex="0"
                                        >15</span
                                    >
                                    <span
                                        class="number-item"
                                        tabindex="0"
                                        >7</span
                                    >
                                    <span
                                        class="number-item"
                                        tabindex="0"
                                        >4</span
                                    >
                                </li>
                                <li
                                    class="detail-item"
                                    tabindex="0"
                                >
                                    <p>
                                        Lorem ipsum dolor sit amet consectetur
                                        adipisicing elit. Earum rerum mollitia
                                        voluptatem.
                                    </p>
                                </li>
                                <li
                                    class="detail-item"
                                    tabindex="0"
                                >
                                    <i>Früher Check-in möglich</i>
                                </li>
                            </ol>
                        </div>
                    </li>

                    <li
                        class="room-item"
                        data-room="four"
                    >
                        <header class="room-header">
                            <input
                                type="radio"
                                id="room-4"
                                name="rooms"
                                value="four"
                                aria-describedby="room-navigation-help"
                            />
                            <label for="room-4">Raum Vier</label>
                        </header>
                        <div class="room-details">
                            <ol>
                                <li
                                    class="detail-item numbers"
                                    tabindex="0"
                                >
                                    <span
                                        class="number-item"
                                        tabindex="0"
                                        >11</span
                                    >
                                    <span
                                        class="number-item"
                                        tabindex="0"
                                        >2</span
                                    >
                                    <span
                                        class="number-item"
                                        tabindex="0"
                                        >9</span
                                    >
                                </li>
                                <li
                                    class="detail-item"
                                    tabindex="0"
                                >
                                    <p>
                                        Lorem ipsum dolor sit, amet consectetur
                                        adipisicing elit. Molestiae nobis
                                        deleniti quas natus non sunt
                                        praesentium? Id, quaerat reprehenderit.
                                    </p>
                                </li>
                                <li
                                    class="detail-item"
                                    tabindex="0"
                                >
                                    <i>Später Check-out verfügbar</i>
                                </li>
                            </ol>
                        </div>
                    </li>
                </ul>
            </fieldset>
        </form>

        <h1>Beschreibung</h1>
        <p>
            Die Räume sind eine Liste, hier <code>&lt;ul&gt;</code>. Vorteil:
            der Screenreader liest Struktur und Anzahl der Raumeinträge vor.
        </p>

        <p>
            Ein einzelner Raum ist eine Zusammenstellung von ggf. Überschriften,
            Listen und Texten. Auch hier liest der Screenreader Struktur und
            Anzahl, zum Beispiel der Badges (&lt;ol&gt;) vor.
        </p>

        <p>
            Bei Erreichen eines Raumes (Pfeiltasten rauf/runter) wird nur der
            Raumname vorgelesen und die Steuerung angekündigt. Über die
            programmierte Tastatursteuerung können dann die Inhalte pro Raum
            angefordert werden (Pfeiltasten links/rechts).
        </p>

        <div class="screenreader-output">
            <div class="screenreader-title">VoiceOver Simulation</div>
            <div
                class="screenreader-text"
                id="voiceover-text"
            >
                Zimmernavigation bereit
            </div>
        </div>

        <div class="keyboard-hint">
            Verwende ↑↓ um Räume zu navigieren, Leertaste zum Auswählen, ←→ für
            Raumdetails
        </div>

        <script>
            class ScreenReaderSimulator {
                constructor() {
                    this.currentElement = null
                    this.verbosityLevel = "detailed" // 'brief', 'detailed', 'verbose'
                    this.readingMode = "navigate" // 'navigate', 'browse', 'forms'
                    this.output = document.getElementById("voiceover-text")
                }

                // Hauptfunktion: Element fokussieren und vorlesen
                focusElement(element) {
                    this.currentElement = element
                    const announcement = this.generateAnnouncement(element)
                    this.announce(announcement)
                }

                // Generiert Ansage basierend auf DOM-Struktur und ARIA
                generateAnnouncement(element) {
                    if (!element) return ""

                    let parts = []

                    // 1. Elementtyp und Rolle ermitteln
                    const role = this.getEffectiveRole(element)
                    parts.push(this.getRoleAnnouncement(role, element))

                    // 2. Zugänglicher Name ermitteln
                    const accessibleName = this.getAccessibleName(element)
                    if (accessibleName) {
                        parts.unshift(accessibleName)
                    }

                    // 3. Zustand ermitteln
                    const state = this.getStateAnnouncement(element)
                    if (state) {
                        parts.push(state)
                    }

                    // 4. Position in Container ermitteln
                    const position = this.getPositionAnnouncement(element)
                    if (position) {
                        parts.push(position)
                    }

                    // 5. Beschreibung ermitteln
                    const description = this.getAccessibleDescription(element)
                    if (description && this.verbosityLevel !== "brief") {
                        parts.push(description)
                    }

                    // 6. Interaktionshinweise
                    const hints = this.getInteractionHints(element)
                    if (hints && this.verbosityLevel === "verbose") {
                        parts.push(hints)
                    }

                    return parts.filter((part) => part).join(", ")
                }

                // Effektive Rolle ermitteln (role-Attribut oder implizite Rolle)
                getEffectiveRole(element) {
                    const explicitRole = element.getAttribute("role")
                    if (explicitRole) return explicitRole

                    const tagName = element.tagName.toLowerCase()
                    const type = element.getAttribute("type")

                    // Implizite Rollen basierend auf HTML-Semantik
                    const implicitRoles = {
                        'input[type="radio"]': "radio",
                        'input[type="checkbox"]': "checkbox",
                        'input[type="button"]': "button",
                        "button": "button",
                        "a": "link",
                        "li": "listitem",
                        "ul": "list",
                        "ol": "list",
                        "h1": "heading",
                        "h2": "heading",
                        "h3": "heading",
                        "h4": "heading",
                        "h5": "heading",
                        "h6": "heading",
                        "p": "paragraph",
                        "label": "label",
                        "fieldset": "group",
                        "legend": "legend",
                    }

                    if (type && tagName === "input") {
                        return (
                            implicitRoles[`${tagName}[type="${type}"]`] ||
                            "textbox"
                        )
                    }

                    return implicitRoles[tagName] || "generic"
                }

                // Rollenansage generieren
                getRoleAnnouncement(role, element) {
                    const roleAnnouncements = {
                        radio: "Optionsfeld",
                        checkbox: "Kontrollkästchen",
                        button: "Schaltfläche",
                        link: "Link",
                        listitem: "Listenelement",
                        list: "Liste",
                        heading: this.getHeadingAnnouncement(element),
                        paragraph: null, // Wird meist nicht angesagt
                        textbox: "Eingabefeld",
                        group: "Gruppe",
                        generic: null,
                    }

                    return roleAnnouncements[role] || role
                }

                // Überschriften-Level ermitteln
                getHeadingAnnouncement(element) {
                    const level =
                        element.tagName.match(/h(\d)/i)?.[1] ||
                        element.getAttribute("aria-level")
                    return level ? `Überschrift Ebene ${level}` : "Überschrift"
                }

                // Zugänglichen Namen ermitteln (Accessible Name Calculation)
                getAccessibleName(element) {
                    // 1. aria-labelledby
                    const labelledby = element.getAttribute("aria-labelledby")
                    if (labelledby) {
                        const labelElements = labelledby
                            .split(" ")
                            .map((id) => document.getElementById(id))
                            .filter((el) => el)
                        if (labelElements.length > 0) {
                            return labelElements
                                .map((el) => el.textContent.trim())
                                .join(" ")
                        }
                    }

                    // 2. aria-label
                    const ariaLabel = element.getAttribute("aria-label")
                    if (ariaLabel) return ariaLabel.trim()

                    // 3. Label-Element (für form controls)
                    if (element.tagName === "INPUT") {
                        const id = element.id
                        if (id) {
                            const label = document.querySelector(
                                `label[for="${id}"]`
                            )
                            if (label) return label.textContent.trim()
                        }

                        // Label als Parent
                        const parentLabel = element.closest("label")
                        if (parentLabel) {
                            return parentLabel.textContent
                                .replace(element.value || "", "")
                                .trim()
                        }
                    }

                    // 4. Eigener Textinhalt
                    if (element.textContent && element.textContent.trim()) {
                        return element.textContent.trim()
                    }

                    // 5. Alt-Attribut (für Bilder)
                    const alt = element.getAttribute("alt")
                    if (alt !== null) return alt

                    // 6. Placeholder
                    const placeholder = element.getAttribute("placeholder")
                    if (placeholder) return placeholder

                    return null
                }

                // Zustandsansage ermitteln
                getStateAnnouncement(element) {
                    let states = []

                    // Checked state
                    if (element.hasAttribute("checked") || element.checked) {
                        states.push("ausgewählt")
                    } else if (
                        element.type === "radio" ||
                        element.type === "checkbox"
                    ) {
                        states.push("nicht ausgewählt")
                    }

                    // Disabled state
                    if (
                        element.disabled ||
                        element.getAttribute("aria-disabled") === "true"
                    ) {
                        states.push("deaktiviert")
                    }

                    // Expanded state
                    const expanded = element.getAttribute("aria-expanded")
                    if (expanded === "true") {
                        states.push("ausgeklappt")
                    } else if (expanded === "false") {
                        states.push("eingeklappt")
                    }

                    // Required state
                    if (
                        element.required ||
                        element.getAttribute("aria-required") === "true"
                    ) {
                        states.push("erforderlich")
                    }

                    // Invalid state
                    if (element.getAttribute("aria-invalid") === "true") {
                        states.push("ungültig")
                    }

                    return states.join(", ")
                }

                // Position im Container ermitteln
                getPositionAnnouncement(element) {
                    const parent = element.parentElement
                    if (!parent) return null

                    // Position in Liste
                    if (parent.tagName === "UL" || parent.tagName === "OL") {
                        const siblings = Array.from(parent.children).filter(
                            (child) => child.tagName === element.tagName
                        )
                        const position = siblings.indexOf(element) + 1
                        const total = siblings.length
                        return `${position} von ${total}`
                    }

                    // Position in Gruppe (role="group" oder fieldset)
                    if (
                        parent.getAttribute("role") === "group" ||
                        parent.tagName === "FIELDSET"
                    ) {
                        const siblings = Array.from(parent.children).filter(
                            (child) =>
                                this.getEffectiveRole(child) ===
                                this.getEffectiveRole(element)
                        )
                        if (siblings.length > 1) {
                            const position = siblings.indexOf(element) + 1
                            const total = siblings.length
                            return `${position} von ${total}`
                        }
                    }

                    return null
                }

                // Zugängliche Beschreibung ermitteln
                getAccessibleDescription(element) {
                    // aria-describedby
                    const describedby = element.getAttribute("aria-describedby")
                    if (describedby) {
                        const descElements = describedby
                            .split(" ")
                            .map((id) => document.getElementById(id))
                            .filter((el) => el)
                        if (descElements.length > 0) {
                            return descElements
                                .map((el) => el.textContent.trim())
                                .join(" ")
                        }
                    }

                    // aria-description
                    const ariaDescription =
                        element.getAttribute("aria-description")
                    if (ariaDescription) return ariaDescription.trim()

                    return null
                }

                // Interaktionshinweise generieren
                getInteractionHints(element) {
                    const role = this.getEffectiveRole(element)
                    const hints = {
                        radio: "Verwenden Sie die Pfeiltasten zur Navigation",
                        checkbox: "Drücken Sie die Leertaste zum Umschalten",
                        button: "Drücken Sie die Eingabetaste oder Leertaste zum Aktivieren",
                        link: "Drücken Sie die Eingabetaste zum Folgen des Links",
                    }

                    return hints[role] || null
                }

                // Ansage ausgeben
                announce(text) {
                    if (!text) return

                    this.output.textContent = text

                    // Visuelle Animation wie bei echtem Screenreader
                    setTimeout(() => {
                        this.output.style.backgroundColor = "#2a2a2a"
                        setTimeout(() => {
                            this.output.style.backgroundColor = "#1a1a1a"
                        }, 200)
                    }, 100)

                    // Optional: Auch an echte Screen Reader weiterleiten
                    this.announceToScreenReader(text)
                }

                // An echte Screen Reader weiterleiten (falls verfügbar)
                announceToScreenReader(text) {
                    // Live Region für echte Screen Reader
                    let liveRegion = document.getElementById("sr-live-region")
                    if (!liveRegion) {
                        liveRegion = document.createElement("div")
                        liveRegion.id = "sr-live-region"
                        liveRegion.setAttribute("aria-live", "assertive")
                        liveRegion.setAttribute("aria-atomic", "true")
                        liveRegion.style.position = "absolute"
                        liveRegion.style.left = "-10000px"
                        liveRegion.style.width = "1px"
                        liveRegion.style.height = "1px"
                        liveRegion.style.overflow = "hidden"
                        document.body.appendChild(liveRegion)
                    }

                    liveRegion.textContent = text
                }
            }

            // RoomNavigation Klasse anpassen
            class RoomNavigation {
                constructor() {
                    this.rooms = document.querySelectorAll(".room-item")
                    this.currentRoomIndex = 0
                    this.currentDetailIndex = -1
                    this.isInDetailMode = false
                    this.currentDetailItems = []
                    this.screenReader = new ScreenReaderSimulator() // Neue Screenreader-Instanz

                    this.init()
                }

                init() {
                    this.setFocus(0)
                    this.bindEvents()
                }

                bindEvents() {
                    document.addEventListener("keydown", (e) =>
                        this.handleKeyDown(e)
                    )

                    // Mouse support
                    this.rooms.forEach((room, index) => {
                        room.addEventListener("click", () => {
                            this.selectRoom(index)
                        })
                    })
                }

                announceToVoiceOver(text) {
                    this.voiceoverOutput.textContent = text
                    // Simulate screen reader announcement timing
                    setTimeout(() => {
                        this.voiceoverOutput.style.backgroundColor = "#2a2a2a"
                        setTimeout(() => {
                            this.voiceoverOutput.style.backgroundColor =
                                "#1a1a1a"
                        }, 200)
                    }, 100)
                }

                getRoomAnnouncement(roomIndex) {
                    const room = this.rooms[roomIndex]
                    const label = room.querySelector("label").textContent
                    const radio = room.querySelector('input[type="radio"]')
                    const isChecked = radio.checked
                    const roomNumber = roomIndex + 1
                    const totalRooms = this.rooms.length

                    return `${label}, Optionsfeld, ${
                        isChecked ? "ausgewählt" : "nicht ausgewählt"
                    }, ${roomNumber} von ${totalRooms}. Zum Erweitern der Details, Pfeil rechts drücken.`
                }

                getDetailAnnouncement(detailIndex) {
                    const currentDetail = this.currentDetailItems[detailIndex]
                    const totalDetails = this.currentDetailItems.length
                    const detailNumber = detailIndex + 1

                    if (currentDetail.classList.contains("numbers")) {
                        const numbers = Array.from(
                            currentDetail.querySelectorAll(".number-item")
                        )
                            .map((item) => item.textContent)
                            .join(", ")
                        return `Detail ${detailNumber} von ${totalDetails}: Zahlen, ${numbers}`
                    } else if (currentDetail.querySelector("p")) {
                        const text =
                            currentDetail.querySelector("p").textContent
                        return `Detail ${detailNumber} von ${totalDetails}: ${text}`
                    } else if (currentDetail.querySelector("i")) {
                        const text =
                            currentDetail.querySelector("i").textContent
                        return `Detail ${detailNumber} von ${totalDetails}: ${text}`
                    }

                    return `Detail ${detailNumber} von ${totalDetails}`
                }

                handleKeyDown(e) {
                    switch (e.key) {
                        case "ArrowUp":
                            e.preventDefault()
                            // Always navigate rooms, exit detail mode if necessary
                            if (this.isInDetailMode) {
                                this.exitDetailMode()
                            }
                            this.navigateRooms(-1)
                            break

                        case "ArrowDown":
                            e.preventDefault()
                            // Always navigate rooms, exit detail mode if necessary
                            if (this.isInDetailMode) {
                                this.exitDetailMode()
                            }
                            this.navigateRooms(1)
                            break

                        case "ArrowLeft":
                            e.preventDefault()
                            if (this.isInDetailMode) {
                                this.navigateDetails(-1)
                            } else {
                                this.announceToVoiceOver(
                                    "Pfeil links: Keine Aktion verfügbar. Pfeil rechts drücken um Zimmerdetails zu erweitern."
                                )
                            }
                            break

                        case "ArrowRight":
                            e.preventDefault()
                            if (this.isInDetailMode) {
                                this.navigateDetails(1)
                            } else {
                                this.enterDetailMode()
                            }
                            break

                        case " ":
                            e.preventDefault()
                            if (!this.isInDetailMode) {
                                this.selectRoom(this.currentRoomIndex)
                                this.announceToVoiceOver(
                                    `${
                                        this.rooms[
                                            this.currentRoomIndex
                                        ].querySelector("label").textContent
                                    } ausgewählt`
                                )
                            } else {
                                this.announceToVoiceOver(
                                    "Leertaste: Keine Aktion verfügbar im Detailmodus. Escape drücken um Details zu verlassen."
                                )
                            }
                            break

                        case "Escape":
                            e.preventDefault()
                            if (this.isInDetailMode) {
                                this.exitDetailMode()
                            } else {
                                this.announceToVoiceOver(
                                    "Escape: Kein Detailmodus zum Verlassen."
                                )
                            }
                            break
                    }
                }

                setFocus(roomIndex) {
                    // Remove focus from all rooms
                    this.rooms.forEach((room) => {
                        room.classList.remove("focus-outline")
                        room.classList.remove("room-detail-focus")
                    })

                    // Add focus to current room
                    this.rooms[roomIndex].classList.add("focus-outline")
                    this.rooms[roomIndex].scrollIntoView({
                        behavior: "smooth",
                        block: "nearest",
                    })

                    // Automatically check the radio button when room gets focus
                    this.selectRoom(roomIndex)

                    // Use ScreenReaderSimulator instead of manual announcement
                    const radioButton = this.rooms[roomIndex].querySelector(
                        'input[type="radio"]'
                    )
                    this.screenReader.focusElement(radioButton)
                }

                navigateRooms(direction) {
                    this.currentRoomIndex = Math.max(
                        0,
                        Math.min(
                            this.rooms.length - 1,
                            this.currentRoomIndex + direction
                        )
                    )
                    this.setFocus(this.currentRoomIndex)
                }

                navigateDetails(direction) {
                    if (this.currentDetailItems.length === 0) return

                    this.currentDetailIndex = Math.max(
                        0,
                        Math.min(
                            this.currentDetailItems.length - 1,
                            this.currentDetailIndex + direction
                        )
                    )
                    this.setDetailFocus(this.currentDetailIndex)

                    // Announce detail
                    this.announceToVoiceOver(
                        this.getDetailAnnouncement(this.currentDetailIndex)
                    )
                }

                setDetailFocus(detailIndex) {
                    // Remove focus from all detail items
                    this.currentDetailItems.forEach((item) =>
                        item.classList.remove("focus-outline")
                    )

                    // Add focus to current detail item
                    if (this.currentDetailItems[detailIndex]) {
                        this.currentDetailItems[detailIndex].classList.add(
                            "focus-outline"
                        )
                        this.currentDetailItems[detailIndex].scrollIntoView({
                            behavior: "smooth",
                            block: "nearest",
                        })

                        // Use ScreenReaderSimulator for detail announcements
                        this.screenReader.focusElement(
                            this.currentDetailItems[detailIndex]
                        )
                    }
                }

                enterDetailMode() {
                    const currentRoom = this.rooms[this.currentRoomIndex]
                    const detailItems =
                        currentRoom.querySelectorAll(".detail-item")

                    if (detailItems.length > 0) {
                        this.isInDetailMode = true
                        this.currentDetailItems = Array.from(detailItems)
                        this.currentDetailIndex = 0

                        // Remove normal room focus and add detail mode focus
                        currentRoom.classList.remove("focus-outline")
                        currentRoom.classList.add("room-detail-focus")

                        // Set detail focus
                        this.setDetailFocus(0)

                        // Announce entering detail mode
                        const roomName =
                            currentRoom.querySelector("label").textContent
                        this.announceToVoiceOver(
                            `Betrete Details für ${roomName}. Verwende Pfeil links und rechts um durch Details zu navigieren, Escape zum Verlassen.`
                        )

                        // Announce first detail after a short delay
                        setTimeout(() => {
                            this.announceToVoiceOver(
                                this.getDetailAnnouncement(0)
                            )
                        }, 1000)
                    }
                }

                exitDetailMode() {
                    if (this.isInDetailMode) {
                        // Remove focus from all detail items
                        this.currentDetailItems.forEach((item) =>
                            item.classList.remove("focus-outline")
                        )

                        // Remove detail mode focus from room
                        const currentRoom = this.rooms[this.currentRoomIndex]
                        currentRoom.classList.remove("room-detail-focus")

                        this.isInDetailMode = false
                        this.currentDetailIndex = -1
                        this.currentDetailItems = []

                        // Restore normal room focus
                        this.setFocus(this.currentRoomIndex)

                        // Announce exiting detail mode
                        this.announceToVoiceOver(
                            `Details verlassen. Zurück zur Zimmernavigation.`
                        )
                    }
                }

                selectRoom(roomIndex) {
                    const room = this.rooms[roomIndex]
                    const radio = room.querySelector('input[type="radio"]')

                    if (radio) {
                        radio.checked = true

                        // Visual feedback
                        this.rooms.forEach((r) =>
                            r.classList.remove("selected")
                        )
                        room.classList.add("selected")

                        // Trigger change event
                        radio.dispatchEvent(
                            new Event("change", { bubbles: true })
                        )
                    }

                    this.currentRoomIndex = roomIndex
                }
            }

            // Initialize navigation when page loads
            document.addEventListener("DOMContentLoaded", () => {
                new RoomNavigation()
            })

            // Handle form submission
            document.querySelector("form").addEventListener("submit", (e) => {
                e.preventDefault()
                const formData = new FormData(e.target)
                const selectedRoom = formData.get("rooms")
                alert(`Ausgewähltes Zimmer: ${selectedRoom}`)
            })
        </script>
    </body>
</html>
