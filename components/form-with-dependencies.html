<!DOCTYPE html>
<html lang="de">
    <head>
        <meta charset="utf-8" />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1"
        />
        <title>Farbauswahl mit Abhängigkeiten</title>
        <style>
            :root {
                --color-primary: #005fb8;
                --color-border: #c5ccd6;
                --color-focus: #ffbf47;
                --color-bg: #f5f7fa;
                --color-surface: #ffffff;
                --radius: 12px;
                --spacing: 1rem;
                --spacing-sm: 0.5rem;
                --spacing-lg: 1.5rem;
                --font-base: "Barlow", system-ui, sans-serif;
            }

            *,
            *::before,
            *::after {
                box-sizing: border-box;
            }

            body {
                margin: 0;
                font-family: var(--font-base);
                background: var(--color-bg);
                color: #1b1b1b;
                line-height: 1.6;
            }

            main {
                max-width: 680px;
                margin: 0 auto;
                padding: var(--spacing-lg) var(--spacing);
            }

            h1 {
                margin-top: 0;
            }

            form {
                background: var(--color-surface);
                border-radius: var(--radius);
                padding: var(--spacing-lg);
                box-shadow: 0 12px 36px rgba(0, 0, 0, 0.05);
                display: grid;
                gap: var(--spacing-lg);
            }

            label {
                font-weight: 600;
            }

            select,
            button {
                font: inherit;
                width: 100%;
                padding: 0.75rem;
                border-radius: 10px;
                border: 2px solid var(--color-border);
                background: #fff;
            }

            select:focus,
            button:focus-visible,
            input[type="radio"]:focus-visible {
                outline: 3px solid var(--color-focus);
                outline-offset: 3px;
            }

            button {
                background: var(--color-primary);
                color: #fff;
                font-weight: 700;
                cursor: pointer;
            }

            fieldset {
                border: 2px solid var(--color-border);
                border-radius: var(--radius);
                padding: var(--spacing);
            }

            legend {
                font-weight: 700;
            }

            .shade-option {
                display: flex;
                align-items: center;
                gap: var(--spacing-sm);
                padding: var(--spacing-sm);
                border-radius: 8px;
            }

            .shade-option:hover {
                background: rgba(0, 95, 184, 0.08);
            }

            .shade-preview {
                width: 32px;
                height: 32px;
                border-radius: 8px;
                border: 2px solid rgba(0, 0, 0, 0.15);
                flex-shrink: 0;
            }

            .sr-only {
                position: absolute;
                width: 1px;
                height: 1px;
                padding: 0;
                margin: -1px;
                overflow: hidden;
                clip: rect(0, 0, 0, 0);
                white-space: nowrap;
                border: 0;
            }

            .explanation {
                margin-top: var(--spacing-lg);
                background: #fff;
                padding: var(--spacing-lg);
                border-radius: var(--radius);
                border: 2px solid var(--color-border);
            }

            .explanation h2 {
                margin-top: 0;
            }

            @media (max-width: 640px) {
                form,
                .explanation {
                    padding: var(--spacing);
                }
            }
        </style>
    </head>
    <body>
        <main>
            <h1 id="page-title">Abhängige Farbauswahl</h1>
            <p>
                Wählen Sie zuerst eine Grundfarbe. Anschließend erscheinen passende
                Helligkeiten als Optionen. Alle Änderungen werden in der Live-Region
                angekündigt.
            </p>

            <form id="color-form" aria-labelledby="page-title">
                <div>
                    <label
                        for="base-color"
                        id="base-color-label"
                    >
                        Schritt&nbsp;1: Grundfarbe auswählen
                    </label>
                    <p id="base-color-hint">
                        Wählen Sie Rot, Grün oder Blau. Danach erscheinen passende
                        Helligkeiten.
                    </p>
                    <select
                        id="base-color"
                        name="base-color"
                        aria-describedby="base-color-hint status-region"
                        required
                    >
                        <option value="">Bitte wählen …</option>
                        <option value="red">Rot</option>
                        <option value="green">Grün</option>
                        <option value="blue">Blau</option>
                    </select>
                </div>

                <fieldset
                    id="shade-fieldset"
                    aria-live="polite"
                    aria-relevant="additions removals"
                >
                    <legend id="shade-legend">
                        Schritt&nbsp;2: Wählen Sie eine Helligkeit
                    </legend>
                    <p id="shade-placeholder">
                        Noch keine Farbe gewählt. Bitte treffen Sie zuerst eine Auswahl
                        oben.
                    </p>
                </fieldset>

                <div>
                    <button type="submit">Auswahl bestätigen</button>
                </div>

                <div
                    id="status-region"
                    class="sr-only"
                    role="status"
                    aria-live="polite"
                    aria-atomic="true"
                ></div>
                <div
                    id="alert-region"
                    class="sr-only"
                    role="alert"
                    aria-live="assertive"
                    aria-atomic="true"
                ></div>
            </form>

            <section
                class="explanation"
                aria-labelledby="screenreader-explanation-title"
            >
                <h2 id="screenreader-explanation-title">
                    Screenreader-Maßnahmen im Überblick
                </h2>
                <ul>
                    <li>
                        <strong>ARIA-Live-Regionen:</strong>
                        <code>role="status"</code> (polite) für Statusmeldungen und
                        <code>role="alert"</code> (assertive) für Fehler. Änderungen
                        werden automatisch vorgelesen.
                    </li>
                    <li>
                        <strong>Dynamisches Feldset:</strong>
                        <code>aria-live="polite"</code> mit
                        <code>aria-relevant="additions removals"</code> sorgt dafür,
                        dass neue Radio-Buttons angekündigt werden, ohne alte Inhalte
                        erneut vorzulesen.
                    </li>
                    <li>
                        <strong>Beschreibungshilfen:</strong>
                        <code>aria-describedby</code> verknüpft Auswahlfelder mit
                        Hinweisen, damit Screenreader die erklärenden Texte mitlesen.
                    </li>
                    <li>
                        <strong>Focus-Management:</strong>
                        Nach dem Laden der Helligkeiten erhält die erste Option den
                        Fokus, sodass Tastatur- und Screenreader-Nutzer direkt
                        weiternavigieren können.
                    </li>
                </ul>
            </section>
        </main>

        <script>
            const colorForm = document.getElementById("color-form")
            const baseColorSelect = document.getElementById("base-color")
            const shadeFieldset = document.getElementById("shade-fieldset")
            const shadeLegend = document.getElementById("shade-legend")
            const statusRegion = document.getElementById("status-region")
            const alertRegion = document.getElementById("alert-region")

            const shades = {
                red: {
                    legend: "Schritt 2: Helligkeit für Rot wählen",
                    options: [
                        { value: "light-red", label: "Hellrot", hex: "#ffb3b3" },
                        { value: "medium-red", label: "Mittelrot", hex: "#ff4d4d" },
                        { value: "dark-red", label: "Dunkelrot", hex: "#b30000" }
                    ]
                },
                green: {
                    legend: "Schritt 2: Helligkeit für Grün wählen",
                    options: [
                        { value: "light-green", label: "Hellgrün", hex: "#c6ffc6" },
                        { value: "medium-green", label: "Mittelgrün", hex: "#4cd34c" },
                        { value: "dark-green", label: "Dunkelgrün", hex: "#117a11" }
                    ]
                },
                blue: {
                    legend: "Schritt 2: Helligkeit für Blau wählen",
                    options: [
                        { value: "light-blue", label: "Hellblau", hex: "#b3d9ff" },
                        { value: "medium-blue", label: "Mittelblau", hex: "#3385ff" },
                        { value: "dark-blue", label: "Dunkelblau", hex: "#003380" }
                    ]
                }
            }

            function announce(target, message) {
                if (!target) return
                target.textContent = ""
                void target.offsetHeight
                target.textContent = message
            }

            function renderShades(colorKey) {
                shadeFieldset.innerHTML = ""
                const config = shades[colorKey]

                if (!config) {
                    shadeFieldset.appendChild(
                        document.getElementById("shade-placeholder")
                    )
                    shadeLegend.textContent =
                        "Schritt 2: Wählen Sie eine Helligkeit"
                    announce(alertRegion, "Keine passende Auswahl gefunden.")
                    return
                }

                shadeLegend.textContent = config.legend

                const list = document.createElement("div")
                list.setAttribute("role", "group")
                list.className = "shade-list"

                config.options.forEach((option, index) => {
                    const wrapper = document.createElement("label")
                    wrapper.className = "shade-option"

                    const radio = document.createElement("input")
                    radio.type = "radio"
                    radio.name = "color-shade"
                    radio.value = option.value
                    radio.required = true
                    radio.setAttribute(
                        "aria-describedby",
                        `${option.value}-desc`
                    )

                    const preview = document.createElement("span")
                    preview.className = "shade-preview"
                    preview.style.backgroundColor = option.hex
                    preview.setAttribute("aria-hidden", "true")

                    const textWrap = document.createElement("span")
                    textWrap.textContent = option.label

                    const desc = document.createElement("span")
                    desc.id = `${option.value}-desc`
                    desc.className = "sr-only"
                    desc.textContent = `Farbwert ${option.hex}`

                    wrapper.appendChild(radio)
                    wrapper.appendChild(preview)
                    wrapper.appendChild(textWrap)
                    wrapper.appendChild(desc)
                    list.appendChild(wrapper)

                    radio.addEventListener("change", () => {
                        announce(
                            statusRegion,
                            `${option.label} mit Farbwert ${option.hex} ausgewählt.`
                        )
                    })

                    if (index === 0) {
                        setTimeout(() => radio.focus(), 120)
                    }
                })

                shadeFieldset.appendChild(list)
                announce(
                    statusRegion,
                    `${config.options.length} Helligkeiten für ${
                        baseColorSelect.options[
                            baseColorSelect.selectedIndex
                        ].text
                    } geladen.`
                )
            }

            baseColorSelect.addEventListener("change", (event) => {
                const selected = event.target.value
                if (!selected) {
                    shadeLegend.textContent =
                        "Schritt 2: Wählen Sie eine Helligkeit"
                    shadeFieldset.innerHTML =
                        '<p id="shade-placeholder">Noch keine Farbe gewählt. Bitte treffen Sie zuerst eine Auswahl oben.</p>'
                    announce(statusRegion, "Auswahl zurückgesetzt.")
                    return
                }
                renderShades(selected)
            })

            colorForm.addEventListener("submit", (event) => {
                event.preventDefault()
                const data = new FormData(colorForm)
                if (!data.get("color-shade")) {
                    announce(
                        alertRegion,
                        "Bitte eine Helligkeit auswählen, bevor Sie fortfahren."
                    )
                    return
                }
                announce(
                    statusRegion,
                    "Danke! Ihre Farbauswahl wurde gespeichert."
                )
                colorForm.reset()
                shadeLegend.textContent =
                    "Schritt 2: Wählen Sie eine Helligkeit"
                shadeFieldset.innerHTML =
                    '<p id="shade-placeholder">Noch keine Farbe gewählt. Bitte treffen Sie zuerst eine Auswahl oben.</p>'
                baseColorSelect.focus()
            })
        </script>
    </body>
</html>